<!DOCTYPE html>
<head>
    <title>Doc search</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FlexSearch/0.7.2/flexsearch.bundle.min.js" integrity="sha512-nFmzFs0vxLvw95r3kpEArM496n1udEDP2OJ+uoyv00RaP4B6NOHbciX0Gr2V9/DxeaHi3fKXLYty8YTLgVkquw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            background: #202229;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Liberation Sans", sans-serif;
            color: #fff; font-size: 20px; font-weight: 300;
            margin: 0; padding: 2em;
        }
        ul { list-style: none; }
        ul li { border-bottom: 1px dashed #999; margin: 20px 0; padding: 1em 0; }
        li > small { display: block; color: #999; margin-bottom: 10px; font-size: 1em; }
        .back, .back:visited { color: #fff; display: block; text-align: center; }
    </style>
</head>

<body>
<a href="index.html" class="back">&laquo; Go back</a>
<ul id="searchList">
</ul>

<script>
    const godoc = {{ CONTENT }};
    function stripHtml(html)
    {
        let tmp = document.createElement("DIV");
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || "";
    }
    for(var key in godoc) {
        godoc[key] = stripHtml(godoc[key])
    }
    var index = new FlexSearch.Index();

    [...Object.entries(godoc)].map((x, idx) => index.add(x[0], x[1]));
    const urlSearchParams = new URLSearchParams(window.location.search);
    const params = Object.fromEntries(urlSearchParams.entries());

    const searchResults = index.search(params.q);
    searchResults.map(x => {
        let contents = godoc[x];
        const listItem = document.createElement('li');
        params.q.split(/\s/g).map(x => contents = contents.replaceAll(x, `<b>${stripHtml(x)}</b>`))
        listItem.innerHTML = `<small>${stripHtml(x)}</small>`;
        listItem.innerHTML += contents;
        searchList.append(listItem);
    })
</script>
</body>
</html>