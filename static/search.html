<style>
#searchForm { position: relative; }
#autocomplete { position: absolute; left: 0; right: 0; top: 40px; background: #fff; color: #61677C; border-radius: 10px; padding: 0 10px;}
#autocomplete label:first-child { margin-top: 10px; }
#autocomplete label:last-child { margin-bottom: 10px; }
#autocomplete label { display: block; padding: 6px 10px; }
#autocomplete label:hover { background: #eee; }
</style>
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
<script src="https://unpkg.com/uhtml"></script>
<script>
    const goIndex = {{ . }};

    var objList = Object.entries(goIndex).map(x => ({key: x[0], text: x[1].replace(/(<([^>]+)>)/gi, "") }))
    const fuseOpts = {
        includeScore: true,
        keys: ['text'],
        includeMatches: true,
        threshold: 0.3,
        ignoreLocation: true
    }
    const fuse = new Fuse(objList, fuseOpts)
    const { render, html } = uhtml;
    searchField.addEventListener("input", (e) => {
        const outList = fuse.search(e.target.value).map(result => {
            var match = new Fuse(result.item.text.split(/\s+/), {threshold:0.7}).search(e.target.value)[0].item
            var full = result.item.text;
            var idx = full.indexOf(match);
            var clamp = (n, low, high) => n > high ? high : n < low ? low : n;
            var highlight = full.substring(clamp(idx - 50, 0, full.length), clamp(idx + 50, idx + match.length, full.length)).split(/\s+/)
            highlight.pop(); highlight.shift()
            highlight = highlight.join(" ")
            return html`<label>${highlight}</label>`
        })
        render(autocomplete, html` ${outList}`);
    })
</script>